!function(e,t){"use strict";function n(t){var n=e.createElement("a");return n.href=decodeURIComponent(t),n}function r(e,t){for(var n=0;n<e.length;n++){var r=t(e[n],n,e);if(r)return r}}function o(e){var t=r(d,function(t){return e.href.match(t)});if(t){console.log("is skimlinks",e.href);var o=n(t[1]);e.href=o.href,e.hostname=o.hostname,e.vendor="skimlinks",e.product=o.href}return e}function f(e){var t=r(p,function(t){return e.href.match(t)});if(t){console.log("is amazon",e.href);var o=n(t[1]);e.href=o.href,e.hostname=o.hostname,e.vendor="amazon",e.product=t[0].split("?")}return e}function a(e){function t(t){for(var n=e.tracker,r=0;r<v.length;r++){var o=v[r],f=e[v[r]];f&&(n+=o+":"+f+"/")}return n+"destination:"+t}function n(t){return r(e.targetHostnames,function(e){return e===t})}return function(e){return n(e.hostname)&&(e.href=t(e.href),e.vendor="performancehorizon",e.redirect=!0),e}}function i(e,t){for(var n=0;n<t.length;n++)if(e.match(t[n]))return!0;return!1}function c(e,t,n){for(var r=0;r<e.length;r++)if(e[r][t].test(n))return e[r]}function u(e,t,n){for(var r=Object.keys(e),o=[],f=0,a=0;a<r.length;a++){var i=r[a],c=i+":"+e[i];if(!(f+c.length<n))break;o.push(c),f+=c.length}return o.join(t)}function s(t,n,r){for(var o=e.links,f={total:0},a=0,c=Object.keys(n),u=0;u<c.length;u++)f[n[c[u]]]=0;for(var s=0;s<o.length;s++){var h=r.reduce(function(e,t){return t(e)},{hostname:o[s].hostname,href:o[s].href}),l=h.href,m=h.hostname;if(l&&m&&function(e){return!i(e,t)}(l)){a++;var d=n[m]||m;f[d]=(f[d]||0)+1}}return f.total=a,f}function h(e,n,r,o){if(t.s){var f=t.s,a=r.url,i=r.product,c=r.vendor,u=r.linkCount,s=r.name,h=[f[a],f[i],f[c],f[u]];f[a]=n.href,f[i]=n.product,f[c]=n.vendor,f[u]=n.linkCount,f.linkTrackVars=[a,i,c,u].join(","),f.linkTrackEvents="none",f.tl(e,"e",s,null,o),f[a]=h[0],f[i]=h[1],f[c]=h[2],f[u]=h[3]}}function l(){!function(e,t,n,r,o,f,a){e.fbq||(o=e.fbq=function(){o.callMethod?o.callMethod.apply(o,arguments):o.queue.push(arguments)},e._fbq||(e._fbq=o),o.push=o,o.loaded=!0,o.version="2.0",o.queue=[],(f=t.createElement(n)).async=!0,f.src="https://connect.facebook.net/en_US/fbevents.js",(a=t.getElementsByTagName(n)[0]).parentNode.insertBefore(f,a))}(t,e,"script")}function m(e){l();var n=t.fbq&&t.fbq.__fbeventsModules;n&&n.fbevents().getState().pixels.map(function(e){return e.id}).indexOf(e)>-1||t.fbq("init",e)}var d=[/go\.redirectingat\.com\/.*url=([^\&]+)/,/go\.skimresources\.com\/.*url=([^\&]+)/],p=[/^https?:\/\/(www\.)?amazon\..*/],v=["camref","creativeref","pubref","adref"],b=1,g=["A"];!function(n){function r(e,t){return t.redirect&&t.href!==e.href?t:e}function o(e,n,o){var f=r(e,n);console.log("open window",{initial:e.href,redirected:n.href,go:f.href}),t.open(f.href,o)||(t.location.href=f.href)}function f(e,t,n){r(t,n)===n&&(console.log("shuffled href",{initial:t.href,redirected:n.href}),e.setAttribute("href",n.href),setTimeout(function(){e.setAttribute("href",t.href)},0))}function a(e){if(e&&e.nodeType===b){if(g.indexOf(e.nodeName)>-1)return e;if(e.parentNode)return a(e.parentNode)}return null}var l=c(n.targetList,"targetLocation",location.href);l&&(n.facebookPixel&&n.facebookPixel.enabled&&n.facebookPixel.id&&m(n.facebookPixel.id),e.addEventListener("click",function(e){var r=a(e.target),c=l.elReducers,m=l.destinationReducers;if(r){var d={hostname:r.hostname,href:r.href},p=c.reduce(function(e,t){return t(e)},{hostname:d.hostname,href:d.href,product:"",vendor:""});if(!i(p.href,n.notExternal)){console.log("is external",p.href);var v=m.reduce(function(e,t){return t(e)},{href:p.href,hostname:p.hostname,vendor:p.vendor});if(n.facebookPixel&&n.facebookPixel.enabled&&n.facebookPixel.targetLinkRegEx.test(r.textContent)&&"function"==typeof t.fbq&&t.fbq("track","AddToCart",{content_type:"product",content_name:p.href}),n.omniture&&n.omniture.enableExitLinkTracking){e.preventDefault();var b=n.shortNames,g=u(s(n.notExternal,b,c),"|",100);h(r,Object.assign({linkCount:g},d,p,v),n.omniture,function(){var e=r.target||"_self";o(d,v,e)})}f(r,d,v)}}},!0))}({targetList:[{targetLocation:/www\.self\.com/,elReducers:[o,f],destinationReducers:[a({tracker:"http://prf.hn/click/",camref:"1011l3dMu",pubref:"Self",targetHostnames:["www.farfetch.com"]})]},{targetLocation:/.*/,elReducers:[o,f],destinationReducers:[a({tracker:"http://demo.prf.hn/click/",camref:"111111l5Vt",pubref:"Self",targetHostnames:["www.farfetch.com"]})]}],notExternal:[/^https?:\/\/[^\/]*\.self\.[^\/]*(\/|$)/m,/^https?:\/\/self\.[^\/]*(\/|$)/m,/^https?:\/\/[^\/]*condenast\.com(\/|$)/m,/^https?:\/\/www\.condenaststore\.com(\/|$)/m,/^https?:\/\/www\.youtube\.com\/user\/SelfMagazine\//m,/^https?:\/\/www\.outbrain\.com\/what-is\/default\/en/m,/^https?:\/\/www\.facebook\.com\//m,/^https?:\/\/twitter\.com\/share/m,/^mailto:/m,/^https?:\/\/www\.pinterest\.com\/pin\/create\/button/m,/^https?:\/\/localhost/m]})}(document,window);
